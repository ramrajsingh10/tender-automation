version: "3.9"

x-python-service: &python-service
  image: python:3.11-slim
  working_dir: /app
  environment:
    PYTHONUNBUFFERED: "1"
  volumes:
    - ./:/workspace
  command: >
    bash -c "pip install --no-cache-dir -r requirements.txt
    && uvicorn app.main:app --host 0.0.0.0 --port 8000 --reload"

services:
  backend:
    <<: *python-service
    container_name: tender-backend
    working_dir: /workspace/backend
    env_file:
      - .env.example
    ports:
      - "8000:8000"

  orchestrator:
    <<: *python-service
    container_name: orchestrator
    working_dir: /workspace/services/orchestrator
    env_file:
      - config/docker-services.env.example
    ports:
      - "8080:8000"
    command: >
      bash -c "pip install --no-cache-dir -r requirements.txt
      && uvicorn main:app --host 0.0.0.0 --port 8000 --reload"

  ingest-worker:
    <<: *python-service
    container_name: ingest-worker
    working_dir: /workspace/services/ingest_worker
    env_file:
      - config/docker-services.env.example
    ports:
      - "8700:8000"
    command: >
      bash -c "pip install --no-cache-dir -r requirements.txt
      && uvicorn main:app --host 0.0.0.0 --port 8000 --reload"
